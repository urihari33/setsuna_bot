# ç¬¬4ç« : AIåˆ†æã‚·ã‚¹ãƒ†ãƒ ã®å®Ÿè£…

## **ç« ã®æ¦‚è¦**

ã“ã®ç« ã§ã¯ã€OpenAI GPT APIã‚’æ´»ç”¨ã—ãŸYouTubeå‹•ç”»ã®è‡ªå‹•åˆ†æã‚·ã‚¹ãƒ†ãƒ ã«ã¤ã„ã¦è©³ã—ãè§£èª¬ã—ã¾ã™ã€‚ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒªãƒ³ã‚°ã€JSONæŠ½å‡ºã€ã‚¨ãƒ©ãƒ¼å‡¦ç†ã€ãƒãƒƒãƒå‡¦ç†ã¾ã§ã€å®Ÿè·µçš„ãªAIé€£æºæŠ€è¡“ã‚’ä½“ç³»çš„ã«å­¦ã³ã¾ã™ã€‚

**å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«**: `analyzers/description_analyzer.py` (ç´„478è¡Œ)  
**ä¸»è¦æŠ€è¡“**: OpenAI GPT API, ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒªãƒ³ã‚°, JSONå‡¦ç†, ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

---

## **ğŸ“‹ description_analyzer.pyãƒ•ã‚¡ã‚¤ãƒ«ã®å…¨ä½“åƒ**

### **ãƒ•ã‚¡ã‚¤ãƒ«ã®ç›®çš„ã¨å½¹å‰²**

`analyzers/description_analyzer.py`ã¯ã€YouTubeãƒŠãƒ¬ãƒƒã‚¸ã‚·ã‚¹ãƒ†ãƒ ã«ãŠã‘ã‚‹**AIåˆ†æã®ä¸­æ ¸ã‚¨ãƒ³ã‚¸ãƒ³**ã§ã™ã€‚ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒæ‹…ã†å½¹å‰²ã¯ï¼š

1. **è‡ªç„¶è¨€èªå‡¦ç†**: YouTubeå‹•ç”»ã®èª¬æ˜æ–‡ã‚’AIã§è§£æ
2. **æ§‹é€ åŒ–ãƒ‡ãƒ¼ã‚¿æŠ½å‡º**: éæ§‹é€ åŒ–ãƒ†ã‚­ã‚¹ãƒˆã‹ã‚‰æ§‹é€ åŒ–æƒ…å ±ã‚’æŠ½å‡º
3. **ã‚¯ãƒªã‚¨ã‚¤ã‚¿ãƒ¼æƒ…å ±ç‰¹å®š**: ä½œè©ãƒ»ä½œæ›²ãƒ»ã‚¤ãƒ©ã‚¹ãƒˆç­‰ã®æ‹…å½“è€…è‡ªå‹•è­˜åˆ¥
4. **éŸ³æ¥½æƒ…å ±è§£æ**: æ­Œè©ãƒ»ã‚¸ãƒ£ãƒ³ãƒ«ãƒ»ä½¿ç”¨ãƒ„ãƒ¼ãƒ«ã®æŠ½å‡º
5. **å“è³ªç®¡ç†**: åˆ†æçµæœã®ä¿¡é ¼åº¦è©•ä¾¡ã¨æ¤œè¨¼

### **ã‚·ã‚¹ãƒ†ãƒ å†…ã§ã®ä½ç½®ã¥ã‘**

```
YouTube Knowledge System AIåˆ†æãƒ•ãƒ­ãƒ¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  collectors/multi_playlist_collector.py â”‚
â”‚  (YouTubeå‹•ç”»ãƒ‡ãƒ¼ã‚¿åé›†)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼ å‹•ç”»èª¬æ˜æ–‡
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  analyzers/description_analyzer.py   â”‚ â† ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«
â”‚  ãƒ»ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒªãƒ³ã‚°              â”‚
â”‚  ãƒ»OpenAI APIé€£æº                    â”‚
â”‚  ãƒ»JSONæŠ½å‡ºãƒ»ä¿®å¾©                     â”‚
â”‚  ãƒ»ãƒãƒƒãƒå‡¦ç†                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼ æ§‹é€ åŒ–åˆ†æçµæœ
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  storage/unified_storage.py           â”‚
â”‚  (çµ±åˆãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ä¿å­˜)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **ä»–ãƒ•ã‚¡ã‚¤ãƒ«ã¨ã®é–¢é€£æ€§**

- **`core/data_models.py`**: åˆ†æçµæœã‚’`CreativeInsight`ãƒ»`CreatorInfo`ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å¤‰æ›
- **`collectors/multi_playlist_collector.py`**: åé›†ã—ãŸå‹•ç”»ãƒ‡ãƒ¼ã‚¿ã®æ¦‚è¦æ¬„ã‚’åˆ†æå¯¾è±¡ã¨ã—ã¦å—ã‘å–ã‚Š
- **`storage/unified_storage.py`**: åˆ†æçµæœã‚’çµ±åˆãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ä¿å­˜
- **`gui/video_main_window.py`**: GUIä¸Šã§åˆ†æãƒ—ãƒ­ã‚»ã‚¹ã®é–‹å§‹ãƒ»é€²æ—ç›£è¦–
- **`.env`**: OpenAI APIã‚­ãƒ¼ã®ç’°å¢ƒå¤‰æ•°ç®¡ç†

### **ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆï¼ˆ478è¡Œã®å†…è¨³ï¼‰**

1. **åˆæœŸåŒ–ãƒ»è¨­å®š** (1-35è¡Œ): ã‚¯ãƒ©ã‚¹å®šç¾©ã€APIè¨­å®šã€ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆä½œæˆ
2. **ã‚³ã‚¢AIåˆ†æ** (36-125è¡Œ): OpenAI APIå‘¼ã³å‡ºã—ã€JSONæŠ½å‡º
3. **JSONä¿®å¾©ã‚·ã‚¹ãƒ†ãƒ ** (126-215è¡Œ): ä¸æ­£JSONã®è‡ªå‹•ä¿®å¾©æ©Ÿèƒ½
4. **ãƒãƒƒãƒå‡¦ç†** (216-245è¡Œ): è¤‡æ•°å‹•ç”»ã®åŠ¹ç‡çš„ãªä¸€æ‹¬åˆ†æ
5. **æ´å¯ŸæŠ½å‡º** (246-320è¡Œ): åˆ†æçµæœã‹ã‚‰ã®çµ±è¨ˆãƒ»å‚¾å‘æŠ½å‡º
6. **ãƒ•ã‚¡ã‚¤ãƒ«ä¿å­˜ãƒ»ãƒ†ã‚¹ãƒˆ** (321-478è¡Œ): çµæœä¿å­˜ã€ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³å®Ÿè¡Œ

---

## **ğŸ¤– OpenAI GPT APIã‚’ä½¿ã£ãŸå‹•ç”»åˆ†æ**

### **OpenAI APIã¨ã¯ï¼ˆåˆå¿ƒè€…å‘ã‘è§£èª¬ï¼‰**

#### **ğŸ§  å¤§è¦æ¨¡è¨€èªãƒ¢ãƒ‡ãƒ«ã®åŸºæœ¬æ¦‚å¿µ**

**GPTã®ä»•çµ„ã¿**

GPTï¼ˆGenerative Pre-trained Transformerï¼‰ã¯ã€å¤§é‡ã®ãƒ†ã‚­ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã§è¨“ç·´ã•ã‚ŒãŸ**è¨€èªç†è§£AI**ã§ã™ã€‚äººé–“ã®è¨€èªãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’å­¦ç¿’ã—ã€è‡ªç„¶ãªæ–‡ç« ç”Ÿæˆã‚„ç†è§£ãŒå¯èƒ½ã§ã™ã€‚

```
å¾“æ¥ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ :
if "ä½œè©" in text:
    lyricist = extract_name_after_keyword(text, "ä½œè©")
# â†‘ æ±ºã¾ã£ãŸãƒ‘ã‚¿ãƒ¼ãƒ³ã—ã‹æŠ½å‡ºã§ããªã„

GPT AI:
"ã“ã®å‹•ç”»ã®èª¬æ˜æ–‡ã‹ã‚‰ä½œè©è€…ã‚’æ•™ãˆã¦"
â†’ æ§˜ã€…ãªè¡¨ç¾ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ç†è§£ã—ã¦æŠ½å‡º
   "è©ï¼šç”°ä¸­å¤ªéƒ" "Lyrics by éˆ´æœ¨èŠ±å­" "ä½œè©æ‹…å½“/å±±ç”°æ¬¡éƒ"
```

**APIã¨ã—ã¦ã®GPTæ´»ç”¨**

OpenAI APIã¯ã€GPTã®èƒ½åŠ›ã‚’**ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‹ã‚‰å‘¼ã³å‡ºã—å¯èƒ½**ã«ã—ãŸã‚µãƒ¼ãƒ“ã‚¹ã§ã™ï¼š

```python
# APIå‘¼ã³å‡ºã—ã®åŸºæœ¬æ§‹é€ 
response = client.chat.completions.create(
    model="gpt-4o-mini",              # ä½¿ç”¨ã™ã‚‹ãƒ¢ãƒ‡ãƒ«
    messages=[                        # ä¼šè©±å±¥æ­´
        {"role": "system", "content": "ã‚ãªãŸã¯å°‚é–€å®¶ã§ã™"},
        {"role": "user", "content": "ã“ã®æ–‡ç« ã‚’åˆ†æã—ã¦"}
    ],
    max_tokens=1000,                  # å¿œç­”ã®æœ€å¤§é•·
    temperature=0.1                   # å‰µé€ æ€§ï¼ˆ0=å³å¯†ã€1=å‰µé€ çš„ï¼‰
)
```

### **APIåˆæœŸåŒ–ã¨è¨­å®š**

#### **ğŸ”‘ èªè¨¼ã¨ãƒ¢ãƒ‡ãƒ«é¸æŠ**

```python
class DescriptionAnalyzer:
    """æ¦‚è¦æ¬„åˆ†æã‚¯ãƒ©ã‚¹"""
    
    def __init__(self, model="gpt-4o-mini"):
        # OpenAI APIè¨­å®š
        api_key = os.getenv('OPENAI_API_KEY')
        if not api_key:
            raise ValueError("OPENAI_API_KEY ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚.envãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚")
        
        self.client = OpenAI(api_key=api_key)
        self.model = model
        
        # åˆ†æãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
        self.analysis_prompt = self._create_analysis_prompt()
```

**ãƒ¢ãƒ‡ãƒ«é¸æŠã®è€ƒæ…®ç‚¹**

```python
# ä¸»è¦ãªOpenAIãƒ¢ãƒ‡ãƒ«æ¯”è¼ƒ
models = {
    "gpt-4o-mini": {
        "cost": "ä½ã‚³ã‚¹ãƒˆ",
        "performance": "é«˜ç²¾åº¦",
        "use_case": "æ—¥å¸¸çš„ãªåˆ†æã‚¿ã‚¹ã‚¯"
    },
    "gpt-4": {
        "cost": "é«˜ã‚³ã‚¹ãƒˆ", 
        "performance": "æœ€é«˜ç²¾åº¦",
        "use_case": "è¤‡é›‘ãªåˆ†æãŒå¿…è¦ãªå ´åˆ"
    },
    "gpt-3.5-turbo": {
        "cost": "æœ€ä½ã‚³ã‚¹ãƒˆ",
        "performance": "æ¨™æº–ç²¾åº¦", 
        "use_case": "å¤§é‡å‡¦ç†ãƒ»å®Ÿé¨“æ®µéš"
    }
}
```

**åˆå¿ƒè€…å‘ã‘: APIã‚­ãƒ¼ã®ç®¡ç†**

```bash
# .env ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£é‡è¦ï¼‰
OPENAI_API_KEY=sk-proj-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx

# ç’°å¢ƒå¤‰æ•°ã¨ã—ã¦èª­ã¿è¾¼ã¿
import os
from dotenv import load_dotenv

load_dotenv()  # .envãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿
api_key = os.getenv('OPENAI_API_KEY')  # å®‰å…¨ã«å–å¾—
```

### **åˆ†æå‡¦ç†ã®å®Ÿè£…**

#### **ğŸ“ ãƒ¡ã‚¤ãƒ³åˆ†æãƒ¡ã‚½ãƒƒãƒ‰**

```python
def analyze_description(self, description: str, video_title: str = "") -> Optional[Dict[str, Any]]:
    """æ¦‚è¦æ¬„ã‚’åˆ†æã—ã¦ã‚¯ãƒªã‚¨ã‚¤ã‚¿ãƒ¼æƒ…å ±ç­‰ã‚’æŠ½å‡º"""
    if not description or len(description.strip()) < 10:
        return None
    
    try:
        # ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã«æ¦‚è¦æ¬„ãƒ†ã‚­ã‚¹ãƒˆã‚’è¿½åŠ 
        full_prompt = self.analysis_prompt + f"\n\nå‹•ç”»ã‚¿ã‚¤ãƒˆãƒ«: {video_title}\n\næ¦‚è¦æ¬„:\n{description}"
        
        # OpenAI APIå‘¼ã³å‡ºã—ï¼ˆãƒˆãƒ¼ã‚¯ãƒ³æ•°ã‚’èª¿æ•´ï¼‰
        response = self.client.chat.completions.create(
            model=self.model,
            messages=[
                {"role": "system", "content": "ã‚ãªãŸã¯éŸ³æ¥½ãƒ»æ˜ åƒåˆ¶ä½œã®å°‚é–€å®¶ã§ã™ã€‚æ­£ç¢ºãªJSONå½¢å¼ã§å›ç­”ã—ã¦ãã ã•ã„ã€‚"},
                {"role": "user", "content": full_prompt}
            ],
            max_tokens=1200,  # ãƒˆãƒ¼ã‚¯ãƒ³æ•°ã‚’å¢—åŠ ï¼ˆJSONå®Œäº†ã‚’ç¢ºä¿ï¼‰
            temperature=0.1   # ä¸€è²«æ€§é‡è¦–ã®ä½æ¸©åº¦è¨­å®š
        )
        
        # ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‹ã‚‰JSONã‚’æŠ½å‡º
        response_text = response.choices[0].message.content.strip()
        
        # JSONéƒ¨åˆ†ã‚’æŠ½å‡ºï¼ˆ```json ã¨ ``` ã®é–“ï¼‰
        json_start = response_text.find('```json')
        if json_start != -1:
            json_start += 7  # '```json'ã®é•·ã•
            json_end = response_text.find('```', json_start)
            if json_end != -1:
                json_text = response_text[json_start:json_end].strip()
            else:
                json_text = response_text[json_start:].strip()
        else:
            # JSONå½¢å¼ã®ãƒãƒ¼ã‚«ãƒ¼ãŒãªã„å ´åˆã€å…¨ä½“ã‚’JSONã¨ã—ã¦è©¦è¡Œ
            json_text = response_text
```

**APIãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®è©³ç´°è§£èª¬**

- **`max_tokens=1200`**: å¿œç­”ã®æœ€å¤§ãƒˆãƒ¼ã‚¯ãƒ³æ•°ï¼ˆ1ãƒˆãƒ¼ã‚¯ãƒ³â‰’0.75å˜èªï¼‰
- **`temperature=0.1`**: å‡ºåŠ›ã®ä¸€è²«æ€§åˆ¶å¾¡ï¼ˆ0=æ±ºå®šè«–çš„ã€1=å‰µé€ çš„ï¼‰
- **`model="gpt-4o-mini"`**: ã‚³ã‚¹ãƒˆãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã«å„ªã‚ŒãŸãƒ¢ãƒ‡ãƒ«

**åˆå¿ƒè€…å‘ã‘: ãƒˆãƒ¼ã‚¯ãƒ³ã¨ã‚³ã‚¹ãƒˆç®¡ç†**

```python
# ãƒˆãƒ¼ã‚¯ãƒ³æ•°ã®æ¦‚ç®—
text = "ã“ã®å‹•ç”»ã®èª¬æ˜æ–‡ã‚’åˆ†æã—ã¦ãã ã•ã„"
approximate_tokens = len(text.split()) * 1.3  # æ—¥æœ¬èªã®å ´åˆã®æ¦‚ç®—

# ã‚³ã‚¹ãƒˆè¦‹ç©ã‚‚ã‚Šï¼ˆ2024å¹´åŸºæº–ï¼‰
cost_per_1k_tokens = {
    "gpt-4o-mini": {"input": 0.00015, "output": 0.0006},  # $
    "gpt-4": {"input": 0.03, "output": 0.06}
}
```

---

## **ğŸ¯ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒªãƒ³ã‚°å®Ÿè·µ**

### **ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒªãƒ³ã‚°ã¨ã¯**

#### **ğŸ“š åŸºæœ¬æ¦‚å¿µã®ç†è§£**

**ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒªãƒ³ã‚°ã®å®šç¾©**

ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒªãƒ³ã‚°ã¨ã¯ã€AIï¼ˆç‰¹ã«å¤§è¦æ¨¡è¨€èªãƒ¢ãƒ‡ãƒ«ï¼‰ã«å¯¾ã—ã¦**é©åˆ‡ãªæŒ‡ç¤ºã‚„è³ªå•ã‚’è¨­è¨ˆ**ã™ã‚‹ã“ã¨ã§ã€æœ›ã‚€çµæœã‚’åŠ¹ç‡çš„ã«å¾—ã‚‹æŠ€è¡“ã§ã™ã€‚

```
æ‚ªã„ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®ä¾‹:
"ã“ã®æ–‡ç« ã‚’åˆ†æã—ã¦"
â†’ æ›–æ˜§ã§ã€AIãŒä½•ã‚’ã™ã¹ãã‹ä¸æ˜ç¢º

è‰¯ã„ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®ä¾‹:
"YouTubeå‹•ç”»ã®èª¬æ˜æ–‡ã‹ã‚‰ã€ä½œè©è€…ãƒ»ä½œæ›²è€…ãƒ»ä½¿ç”¨ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã‚’
JSONå½¢å¼ã§æŠ½å‡ºã—ã¦ãã ã•ã„ã€‚ä¸æ˜ãªå ´åˆã¯nullã¨ã—ã¦ãã ã•ã„ã€‚"
â†’ å…·ä½“çš„ã§ã€æœŸå¾…ã™ã‚‹å‡ºåŠ›å½¢å¼ãŒæ˜ç¢º
```

#### **ğŸ¨ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆè¨­è¨ˆã®åŸå‰‡**

OpenAIã®å…¬å¼ã‚¬ã‚¤ãƒ‰ã«åŸºã¥ã6ã¤ã®æˆ¦ç•¥ï¼š

1. **æ˜ç¢ºãªæŒ‡ç¤ºã‚’æ›¸ã**: å…·ä½“çš„ã§è©³ç´°ãªæŒ‡ç¤º
2. **å‚ç…§ãƒ†ã‚­ã‚¹ãƒˆã‚’æä¾›ã™ã‚‹**: ä¾‹ã‚„ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã®æç¤º
3. **è¤‡é›‘ãªã‚¿ã‚¹ã‚¯ã‚’åˆ†å‰²ã™ã‚‹**: ã‚¹ãƒ†ãƒƒãƒ—ãƒã‚¤ã‚¹ãƒ†ãƒƒãƒ—ã®å‡¦ç†
4. **ã€Œè€ƒãˆã‚‹ã€æ™‚é–“ã‚’ä¸ãˆã‚‹**: æ®µéšçš„ãªæ¨è«–ã‚’ä¿ƒã™
5. **å¤–éƒ¨ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã™ã‚‹**: å¿…è¦ã«å¿œã˜ã¦ä»–ã®æ©Ÿèƒ½ã¨çµ„ã¿åˆã‚ã›
6. **ã‚·ã‚¹ãƒ†ãƒãƒ†ã‚£ãƒƒã‚¯ã«ãƒ†ã‚¹ãƒˆã™ã‚‹**: çµæœã‚’æ¸¬å®šãƒ»æ”¹å–„

### **å®Ÿè£…ã•ã‚ŒãŸãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®è©³ç´°è§£æ**

#### **ğŸ”§ åˆ†æãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®æ§‹é€ **

```python
def _create_analysis_prompt(self) -> str:
    """åˆ†æç”¨ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ä½œæˆï¼ˆã‚³ã‚¹ãƒˆå‰Šæ¸›ç‰ˆï¼‰"""
    return """YouTubeæ¦‚è¦æ¬„ã‹ã‚‰åˆ¶ä½œæƒ…å ±ã‚’JSONæŠ½å‡ºã€‚ä¸æ˜ãªé …ç›®ã¯nullã€‚

é‡è¦: JSONãƒ¬ã‚¹ãƒãƒ³ã‚¹ã¯æ­£ç¢ºãªå½¢å¼ã§å‡ºåŠ›ã—ã¦ãã ã•ã„ã€‚
- æ–‡å­—åˆ—å†…ã®æ”¹è¡Œã¯ \\n ã§ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—
- å¼•ç”¨ç¬¦ã¯ \\" ã§ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—  
- æœ«å°¾ã‚«ãƒ³ãƒã¯ç¦æ­¢

æŠ½å‡ºé …ç›®ï¼š
1. ã‚¯ãƒªã‚¨ã‚¤ã‚¿ãƒ¼ï¼ˆvocal,movie,illustration,composer,lyricist,arranger,mixç­‰ï¼‰
2. æ­Œè©ï¼ˆæœ€åˆã®500æ–‡å­—ã¾ã§ã€æ”¹è¡Œã¯\\nã§ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ï¼‰
3. ãƒ„ãƒ¼ãƒ«ï¼ˆsoftware,instruments,equipmentï¼‰
4. éŸ³æ¥½æƒ…å ±ï¼ˆbpm,key,genre,moodï¼‰

JSONå½¢å¼ï¼ˆå¿…ãš```jsonã¨```ã§å›²ã‚€ï¼‰ï¼š
```json
{
  "creators": {"vocal": "åå‰", "movie": "åå‰", "composer": "åå‰"},
  "lyrics": "æ­Œè©å…¨æ–‡ï¼ˆæ”¹è¡Œã¯\\\\nã§ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ï¼‰",
  "tools": {"software": ["ãƒ„ãƒ¼ãƒ«å"], "instruments": ["æ¥½å™¨å"]},
  "music_info": {"genre": "ã‚¸ãƒ£ãƒ³ãƒ«", "mood": "é›°å›²æ°—"},
  "confidence_score": 0.8
}
```

æ¦‚è¦æ¬„ï¼š
"""
```

**ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆè¨­è¨ˆã®åˆ†æ**

1. **æ˜ç¢ºãªç›®æ¨™è¨­å®š**: "JSONæŠ½å‡º"ã¨ã„ã†å…·ä½“çš„ãªã‚¿ã‚¹ã‚¯
2. **ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆæŒ‡å®š**: å³å¯†ãªJSONæ§‹é€ ã®å®šç¾©
3. **ã‚¨ãƒ©ãƒ¼é˜²æ­¢**: ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—å‡¦ç†ã®æ˜ç¤º
4. **ä¾‹ç¤ºã«ã‚ˆã‚‹å­¦ç¿’**: æœŸå¾…ã™ã‚‹å‡ºåŠ›å½¢å¼ã®ã‚µãƒ³ãƒ—ãƒ«
5. **å“è³ªç®¡ç†**: confidence_scoreã«ã‚ˆã‚‹ä¿¡é ¼åº¦è©•ä¾¡

#### **ğŸ¯ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®æœ€é©åŒ–æŠ€æ³•**

**Few-shot Learningï¼ˆå°‘æ•°ä¾‹å­¦ç¿’ï¼‰ã®å¿œç”¨**

```python
# å®Ÿè£…ä¾‹ï¼šã‚ˆã‚Šè©³ç´°ãªãƒ—ãƒ­ãƒ³ãƒ—ãƒˆï¼ˆå¿…è¦ã«å¿œã˜ã¦æ‹¡å¼µå¯èƒ½ï¼‰
advanced_prompt = """
ä»¥ä¸‹ã®ä¾‹ã‚’å‚è€ƒã«ã€YouTubeæ¦‚è¦æ¬„ã‚’åˆ†æã—ã¦ãã ã•ã„ã€‚

ã€ä¾‹1ã€‘
å…¥åŠ›: "ä½œè©ï¼šç”°ä¸­å¤ªéƒ ä½œæ›²ï¼šéˆ´æœ¨èŠ±å­ ä½¿ç”¨ã‚½ãƒ•ãƒˆï¼šCubase"
å‡ºåŠ›: {"creators": {"lyricist": "ç”°ä¸­å¤ªéƒ", "composer": "éˆ´æœ¨èŠ±å­"}, "tools": {"software": ["Cubase"]}}

ã€ä¾‹2ã€‘
å…¥åŠ›: "Vocal: Alice, Movie: Bob, DAW: Logic Pro"
å‡ºåŠ›: {"creators": {"vocal": "Alice", "movie": "Bob"}, "tools": {"software": ["Logic Pro"]}}

ã€å®Ÿéš›ã®åˆ†æå¯¾è±¡ã€‘
æ¦‚è¦æ¬„: {description}
"""
```

**Chain-of-Thoughtï¼ˆæ€è€ƒã®é€£é–ï¼‰ãƒ—ãƒ­ãƒ³ãƒ—ãƒ†ã‚£ãƒ³ã‚°**

```python
# ã‚ˆã‚Šè©³ç´°ãªæ¨è«–ã‚’ä¿ƒã™ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆä¾‹
reasoning_prompt = """
ä»¥ä¸‹ã®æ‰‹é †ã§å‹•ç”»èª¬æ˜æ–‡ã‚’åˆ†æã—ã¦ãã ã•ã„ï¼š

1. ã¾ãšã€ã‚¯ãƒªã‚¨ã‚¤ã‚¿ãƒ¼æƒ…å ±ã‚’å«ã‚€éƒ¨åˆ†ã‚’ç‰¹å®šã—ã¦ãã ã•ã„
2. æ¬¡ã«ã€éŸ³æ¥½åˆ¶ä½œãƒ„ãƒ¼ãƒ«ã«é–¢ã™ã‚‹è¨˜è¿°ã‚’æ¢ã—ã¦ãã ã•ã„  
3. æ­Œè©ãŒå«ã¾ã‚Œã¦ã„ã‚‹å ´åˆã¯æŠ½å‡ºã—ã¦ãã ã•ã„
4. æœ€å¾Œã«ã€å„æƒ…å ±ã®ä¿¡é ¼åº¦ã‚’è©•ä¾¡ã—ã¦ãã ã•ã„

åˆ†æå¯¾è±¡:
{description}

å›ç­”ã¯ä»¥ä¸‹ã®JSONå½¢å¼ã§ï¼š
{json_format}
"""
```

### **ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒªãƒ³ã‚°ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹**

#### **ğŸ“ˆ åŠ¹æœçš„ãªæŒ‡ç¤ºã®æ›¸ãæ–¹**

**1. å…·ä½“æ€§ã¨æ˜ç¢ºæ€§**
```python
# âŒ æ›–æ˜§ãªæŒ‡ç¤º
"ã“ã®å‹•ç”»ã«ã¤ã„ã¦æ•™ãˆã¦"

# âœ… å…·ä½“çš„ãªæŒ‡ç¤º  
"ã“ã®å‹•ç”»ã®èª¬æ˜æ–‡ã‹ã‚‰ã€åˆ¶ä½œã«é–¢ã‚ã£ãŸäººç‰©ã®åå‰ã¨å½¹å‰²ï¼ˆä½œè©ãƒ»ä½œæ›²ãƒ»æ­Œå”±ãƒ»æ˜ åƒåˆ¶ä½œç­‰ï¼‰ã‚’æŠ½å‡ºã—ã¦ãã ã•ã„"
```

**2. å‡ºåŠ›å½¢å¼ã®æ˜ç¤º**
```python
# âŒ å½¢å¼ä¸æ˜
"ã‚¯ãƒªã‚¨ã‚¤ã‚¿ãƒ¼æƒ…å ±ã‚’æŠ½å‡ºã—ã¦"

# âœ… å½¢å¼æ˜ç¤º
"ä»¥ä¸‹ã®JSONå½¢å¼ã§ã‚¯ãƒªã‚¨ã‚¤ã‚¿ãƒ¼æƒ…å ±ã‚’æŠ½å‡ºã—ã¦ãã ã•ã„ï¼š
{\"creators\": {\"vocal\": \"æ­Œæ‰‹å\", \"composer\": \"ä½œæ›²è€…å\"}}"
```

**3. ã‚¨ãƒ©ãƒ¼å‡¦ç†ã®çµ„ã¿è¾¼ã¿**
```python
# ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆå†…ã§ã®ã‚¨ãƒ©ãƒ¼å‡¦ç†æŒ‡ç¤º
"""
æ³¨æ„äº‹é …ï¼š
- æƒ…å ±ãŒä¸æ˜ç¢ºãªå ´åˆã¯ null ã‚’ä½¿ç”¨
- è¤‡æ•°ã®å€™è£œãŒã‚ã‚‹å ´åˆã¯æœ€ã‚‚å¯èƒ½æ€§ã®é«˜ã„ã‚‚ã®ã‚’é¸æŠ
- ç¢ºä¿¡åº¦ãŒä½ã„å ´åˆã¯ confidence_score ã‚’ä½ãè¨­å®š
"""
```

#### **ğŸ”„ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®åå¾©æ”¹å–„**

**A/Bãƒ†ã‚¹ãƒˆã«ã‚ˆã‚‹æœ€é©åŒ–**

```python
# ãƒãƒ¼ã‚¸ãƒ§ãƒ³A: ã‚·ãƒ³ãƒ—ãƒ«ãªãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
prompt_a = "YouTubeæ¦‚è¦æ¬„ã‹ã‚‰ã‚¯ãƒªã‚¨ã‚¤ã‚¿ãƒ¼æƒ…å ±ã‚’JSONå½¢å¼ã§æŠ½å‡ºã—ã¦ãã ã•ã„"

# ãƒãƒ¼ã‚¸ãƒ§ãƒ³B: è©³ç´°ãªãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ  
prompt_b = """YouTubeæ¦‚è¦æ¬„ã‹ã‚‰ä»¥ä¸‹ã®æƒ…å ±ã‚’JSONå½¢å¼ã§æŠ½å‡ºã—ã¦ãã ã•ã„ï¼š
- ã‚¯ãƒªã‚¨ã‚¤ã‚¿ãƒ¼æƒ…å ±ï¼ˆä½œè©è€…ã€ä½œæ›²è€…ã€æ­Œæ‰‹ã€æ˜ åƒåˆ¶ä½œè€…ç­‰ï¼‰
- ä½¿ç”¨æ¥½å™¨ãƒ»ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢
- éŸ³æ¥½ã‚¸ãƒ£ãƒ³ãƒ«ãƒ»é›°å›²æ°—
- æ­Œè©ï¼ˆ500æ–‡å­—ã¾ã§ï¼‰
å‡ºåŠ›å½¢å¼: {...}"""

# ç²¾åº¦ãƒ»é€Ÿåº¦ãƒ»ã‚³ã‚¹ãƒˆã‚’æ¯”è¼ƒã—ã¦æœ€é©åŒ–
```

---

## **ğŸ”§ JSONæŠ½å‡ºã¨ãƒ‘ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼å¯¾å¿œ**

### **JSONã¨ã¯ï¼ˆåˆå¿ƒè€…å‘ã‘è©³ç´°è§£èª¬ï¼‰**

#### **ğŸ“„ JSONåŸºæœ¬æ§‹é€ ã®ç†è§£**

**JSONã®åŸºæœ¬æ–‡æ³•**

JSONï¼ˆJavaScript Object Notationï¼‰ã¯ã€æ§‹é€ åŒ–ãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ç¾ã™ã‚‹ãŸã‚ã®ãƒ†ã‚­ã‚¹ãƒˆå½¢å¼ã§ã™ï¼š

```json
{
  "name": "ç”°ä¸­å¤ªéƒ",           // æ–‡å­—åˆ—
  "age": 30,                   // æ•°å€¤
  "is_creator": true,          // çœŸå½å€¤
  "skills": ["ä½œè©", "ä½œæ›²"],    // é…åˆ—
  "contact": {                 // ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼ˆãƒã‚¹ãƒˆï¼‰
    "email": "tanaka@example.com",
    "phone": null              // nullå€¤
  }
}
```

**JSONæ–‡æ³•ã®é‡è¦ãƒ«ãƒ¼ãƒ«**

```python
# âœ… æ­£ã—ã„JSON
{
  "title": "ã‚µãƒ³ãƒ—ãƒ«æ¥½æ›²",
  "creators": {
    "composer": "å±±ç”°å¤ªéƒ"
  }
}

# âŒ ã‚ˆãã‚ã‚‹é–“é•ã„
{
  'title': 'ã‚µãƒ³ãƒ—ãƒ«æ¥½æ›²',        # ã‚·ãƒ³ã‚°ãƒ«ã‚¯ã‚©ãƒ¼ãƒˆã¯NG
  "creators": {
    "composer": "å±±ç”°å¤ªéƒ",      # æœ«å°¾ã‚«ãƒ³ãƒã¯NG
  }
}
```

### **AIã‹ã‚‰ã®JSONæŠ½å‡ºå®Ÿè£…**

#### **ğŸ¯ ãƒ¬ã‚¹ãƒãƒ³ã‚¹è§£æã®è©³ç´°**

```python
# ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‹ã‚‰JSONã‚’æŠ½å‡º
response_text = response.choices[0].message.content.strip()

# JSONéƒ¨åˆ†ã‚’æŠ½å‡ºï¼ˆ```json ã¨ ``` ã®é–“ï¼‰
json_start = response_text.find('```json')
if json_start != -1:
    json_start += 7  # '```json'ã®é•·ã•
    json_end = response_text.find('```', json_start)
    if json_end != -1:
        json_text = response_text[json_start:json_end].strip()
    else:
        json_text = response_text[json_start:].strip()
else:
    # JSONå½¢å¼ã®ãƒãƒ¼ã‚«ãƒ¼ãŒãªã„å ´åˆã€å…¨ä½“ã‚’JSONã¨ã—ã¦è©¦è¡Œ
    json_text = response_text
```

**JSONæŠ½å‡ºã®èª²é¡Œã¨å¯¾ç­–**

AIã‹ã‚‰ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã«ã¯ä»¥ä¸‹ã®å•é¡ŒãŒç™ºç”Ÿã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ï¼š

```python
# å•é¡Œä¾‹1: ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³å½¢å¼ã®æ··å…¥
response = """
åˆ†æçµæœã‚’ãŠç¤ºã—ã—ã¾ã™ï¼š

```json
{"creators": {"vocal": "ç”°ä¸­å¤ªéƒ"}}
```

ä»¥ä¸ŠãŒåˆ†æçµæœã§ã™ã€‚
"""

# å•é¡Œä¾‹2: ä¸å®Œå…¨ãªJSON
response = """
{"creators": {"vocal": "ç”°ä¸­å¤ªéƒ", "composer": "éˆ´æœ¨
"""

# å•é¡Œä¾‹3: ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—å‡¦ç†ã®å•é¡Œ
response = """
{"lyrics": "æ­Œè©ã®å†…å®¹
æ”¹è¡ŒãŒå«ã¾ã‚Œã‚‹"}
"""
```

### **å …ç‰¢ãªJSONä¿®å¾©ã‚·ã‚¹ãƒ†ãƒ **

#### **ğŸ› ï¸ è‡ªå‹•ä¿®å¾©æ©Ÿèƒ½ã®å®Ÿè£…**

```python
def _fix_json_response(self, json_text: str) -> Optional[str]:
    """ä¸æ­£ãªJSONãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’ä¿®å¾©"""
    try:
        import re
        
        print(f"ğŸ”§ JSONä¿®å¾©é–‹å§‹...")
        print(f"å…ƒã®JSONï¼ˆæœ€åˆã®200æ–‡å­—ï¼‰: {json_text[:200]}...")
        
        # Step 1: åŸºæœ¬çš„ãªã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°
        fixed_text = json_text.strip()
        
        # Step 2: ä¸å®Œå…¨ãªJSONã‚’æ¤œå‡ºã—ã¦ä¿®å¾©
        # é–‹ã„ãŸå¼•ç”¨ç¬¦ã®æ•°ã‚’ãƒã‚§ãƒƒã‚¯
        quote_count = fixed_text.count('"')
        if quote_count % 2 == 1:
            # å¥‡æ•°ã®å ´åˆã€æœ€å¾Œã«å¼•ç”¨ç¬¦ã‚’è¿½åŠ 
            print("ğŸ”§ ä¸å®Œå…¨ãªæ–‡å­—åˆ—ã‚’æ¤œå‡ºã€å¼•ç”¨ç¬¦ã‚’è¿½åŠ ")
            fixed_text = fixed_text + '"'
        
        # Step 3: lyrics ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ç‰¹åˆ¥å‡¦ç†
        lyrics_match = re.search(r'"lyrics":\s*"([^"]*)', fixed_text)
        if lyrics_match and not re.search(r'"lyrics":\s*"[^"]*"', fixed_text):
            # lyrics ãŒé€”ä¸­ã§åˆ‡ã‚Œã¦ã„ã‚‹å ´åˆ
            print("ğŸ”§ ä¸å®Œå…¨ãªlyricsãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’æ¤œå‡º")
            lyrics_start = lyrics_match.start(1)
            before_lyrics = fixed_text[:lyrics_start]
            # å®‰å…¨ãªçµ‚äº†å‡¦ç†
            safe_ending = '",\n  "tools": null,\n  "music_info": null,\n  "confidence_score": 0.6\n}'
            fixed_text = before_lyrics + safe_ending
```

**ä¿®å¾©æ©Ÿèƒ½ã®æ®µéšçš„ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ**

1. **åŸºæœ¬ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°**: ä½™åˆ†ãªç©ºç™½ãƒ»åˆ¶å¾¡æ–‡å­—ã®é™¤å»
2. **å¼•ç”¨ç¬¦ãƒãƒ©ãƒ³ã‚¹**: é–‹ã„ãŸã¾ã¾ã®æ–‡å­—åˆ—ã®æ¤œå‡ºãƒ»ä¿®æ­£
3. **æ§‹é€ è£œå®Œ**: ä¸å®Œå…¨ãªã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãƒ»é…åˆ—ã®ä¿®æ­£
4. **ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—å‡¦ç†**: æ”¹è¡Œæ–‡å­—ãƒ»ç‰¹æ®Šæ–‡å­—ã®é©åˆ‡ãªã‚¨ã‚¹ã‚±ãƒ¼ãƒ—
5. **ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯**: ä¿®å¾©ä¸å¯èƒ½ãªå ´åˆã®æœ€å°é™JSONç”Ÿæˆ

#### **ğŸ” ã‚¨ãƒ©ãƒ¼ãƒ‘ã‚¿ãƒ¼ãƒ³ã®è©³ç´°åˆ†æ**

**ãƒ‘ã‚¿ãƒ¼ãƒ³1: æ–‡å­—æ•°åˆ¶é™ã«ã‚ˆã‚‹åˆ‡æ–­**

```python
# å•é¡Œã®ã‚ã‚‹ãƒ¬ã‚¹ãƒãƒ³ã‚¹
incomplete_json = '''
{
  "creators": {"vocal": "ç”°ä¸­å¤ªéƒ", "composer": "éˆ´æœ¨èŠ±å­"},
  "lyrics": "ã“ã®æ¥½æ›²ã®æ­Œè©ã¯ç´ æ™´ã‚‰ã—ãã€æ„Ÿå‹•çš„ãªå†…å®¹ã¨ãªã£ã¦ãŠã‚Š
'''

# ä¿®å¾©å‡¦ç†
def fix_truncated_lyrics(text):
    # lyricsãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒä¸å®Œå…¨ãªå ´åˆã®å®‰å…¨ãªçµ‚äº†
    if '"lyrics":' in text and not text.count('"') % 2 == 0:
        # ä¸å®Œå…¨ãª lyrics ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’å®‰å…¨ã«çµ‚äº†
        return text + '",\n  "confidence_score": 0.5\n}'
```

**ãƒ‘ã‚¿ãƒ¼ãƒ³2: ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—å‡¦ç†ã®å•é¡Œ**

```python
# å•é¡Œã®ã‚ã‚‹ãƒ¬ã‚¹ãƒãƒ³ã‚¹
unescaped_json = '''
{
  "lyrics": "å›ã¨æ­©ã„ãŸ
  ã‚ã®é“ã‚’
  ä»Šã§ã‚‚è¦šãˆã¦ã„ã‚‹"
}
'''

# ä¿®å¾©å‡¦ç†
def fix_lyrics_escaping(text):
    def escape_lyrics_content(match):
        lyrics_content = match.group(1)
        # æ”¹è¡Œã‚’ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—
        lyrics_content = lyrics_content.replace('\n', '\\n').replace('\r', '\\r')
        # å†…éƒ¨ã®å¼•ç”¨ç¬¦ã‚’ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—
        lyrics_content = lyrics_content.replace('"', '\\"')
        return f'"lyrics": "{lyrics_content}"'
    
    # lyrics ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ã¿ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—å‡¦ç†
    return re.sub(r'"lyrics":\s*"([^"]*(?:\\"[^"]*)*)"', escape_lyrics_content, text, flags=re.DOTALL)
```

### **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹**

#### **ğŸ›¡ï¸ å¤šå±¤é˜²å¾¡ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ**

```python
try:
    # ãƒ¬ãƒ™ãƒ«1: é€šå¸¸ã®JSONãƒ‘ãƒ¼ã‚¹
    analysis_result = json.loads(json_text)
    
except json.JSONDecodeError as e:
    print(f"JSONè§£æã‚¨ãƒ©ãƒ¼: {e}")
    print(f"ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ†ã‚­ã‚¹ãƒˆ: {response_text}")
    
    try:
        # ãƒ¬ãƒ™ãƒ«2: JSONä¿®å¾©ã‚’è©¦è¡Œ
        fixed_json = self._fix_json_response(json_text)
        if fixed_json:
            analysis_result = json.loads(fixed_json)
            print("âœ… JSONä¿®å¾©æˆåŠŸ")
            
    except Exception as fix_error:
        print(f"JSONä¿®å¾©å¤±æ•—: {fix_error}")
        
        # ãƒ¬ãƒ™ãƒ«3: æœ€å°é™ã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
        return {
            "creators": {},
            "lyrics": "è§£æå¤±æ•—",
            "tools": None,
            "music_info": None,
            "confidence_score": 0.1,
            "error": "JSON parse failed"
        }
```

**ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã®æ´»ç”¨**

```python
# è©³ç´°ãªã‚¨ãƒ©ãƒ¼æƒ…å ±ã®è¨˜éŒ²
error_info = {
    "timestamp": datetime.now().isoformat(),
    "original_response": response_text[:500],  # æœ€åˆã®500æ–‡å­—
    "json_extraction": json_text[:200],       # æŠ½å‡ºã—ãŸJSONéƒ¨åˆ†
    "error_type": type(e).__name__,
    "error_message": str(e),
    "video_title": video_title,
    "description_length": len(description)
}

# ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ï¼ˆãƒ‡ãƒãƒƒã‚°ãƒ»æ”¹å–„ç”¨ï¼‰
log_errors_to_file(error_info)
```

---

## **âš¡ ãƒãƒƒãƒå‡¦ç†ã¨åŠ¹ç‡åŒ–**

### **ãƒãƒƒãƒå‡¦ç†ã®è¨­è¨ˆæ€æƒ³**

#### **ğŸ”„ åŠ¹ç‡çš„ãªä¸€æ‹¬åˆ†æ**

```python
def batch_analyze_videos(self, videos: List[Dict[str, Any]], delay: float = 1.0) -> List[Dict[str, Any]]:
    """è¤‡æ•°å‹•ç”»ã®æ¦‚è¦æ¬„ã‚’ä¸€æ‹¬åˆ†æ"""
    analyzed_videos = []
    
    for i, video in enumerate(videos):
        print(f"åˆ†æä¸­: {i+1}/{len(videos)} - {video.get('title', 'Unknown')}")
        
        # æ¦‚è¦æ¬„åˆ†æ
        description = video.get('description', '')
        title = video.get('title', '')
        
        analysis = self.analyze_description(description, title)
        
        # å…ƒã®å‹•ç”»ãƒ‡ãƒ¼ã‚¿ã«åˆ†æçµæœã‚’è¿½åŠ 
        enhanced_video = video.copy()
        enhanced_video['description_analysis'] = analysis
        
        analyzed_videos.append(enhanced_video)
        
        # APIåˆ¶é™ã‚’è€ƒæ…®ã—ã¦å¾…æ©Ÿ
        if delay > 0:
            time.sleep(delay)
        
        # é€²æ—è¡¨ç¤º
        if (i + 1) % 5 == 0:
            print(f"  {i + 1} ä»¶ã®åˆ†æãŒå®Œäº†ã—ã¾ã—ãŸ")
    
    print(f"å…¨ {len(analyzed_videos)} ä»¶ã®åˆ†æãŒå®Œäº†ã—ã¾ã—ãŸ")
    return analyzed_videos
```

**ãƒãƒƒãƒå‡¦ç†ã®åˆ©ç‚¹**

1. **é€²æ—ã®å¯è¦–åŒ–**: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ã®å‡¦ç†çŠ¶æ³è¡¨ç¤º
2. **ã‚¨ãƒ©ãƒ¼åˆ†é›¢**: 1ä»¶ã®å¤±æ•—ãŒå…¨ä½“ã«å½±éŸ¿ã—ãªã„è¨­è¨ˆ
3. **ãƒ¬ãƒ¼ãƒˆåˆ¶é™å¯¾å¿œ**: APIä½¿ç”¨é‡åˆ¶é™ã¸ã®é…æ…®
4. **ãƒ¡ãƒ¢ãƒªåŠ¹ç‡**: ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°å‡¦ç†ã«ã‚ˆã‚‹çœãƒ¡ãƒ¢ãƒªè¨­è¨ˆ

#### **â±ï¸ ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã¨ã‚³ã‚¹ãƒˆç®¡ç†**

**OpenAI APIåˆ¶é™ã®ç†è§£**

```python
# OpenAI APIåˆ¶é™ï¼ˆ2024å¹´åŸºæº–ï¼‰
api_limits = {
    "requests_per_minute": {
        "gpt-4o-mini": 5000,
        "gpt-4": 500
    },
    "tokens_per_minute": {
        "gpt-4o-mini": 200000,
        "gpt-4": 30000
    },
    "cost_per_1k_tokens": {
        "gpt-4o-mini": {"input": 0.000150, "output": 0.000600},
        "gpt-4": {"input": 0.030000, "output": 0.060000}
    }
}
```

**é©å¿œçš„é…å»¶æ©Ÿèƒ½**

```python
def adaptive_delay_calculation(self, batch_size: int, current_index: int) -> float:
    """ãƒãƒƒãƒã‚µã‚¤ã‚ºã¨é€²æ—ã«å¿œã˜ãŸé©å¿œçš„é…å»¶è¨ˆç®—"""
    
    # åŸºæœ¬é…å»¶ï¼ˆãƒ¬ãƒ¼ãƒˆåˆ¶é™å¯¾å¿œï¼‰
    base_delay = 1.0
    
    # ãƒãƒƒãƒã‚µã‚¤ã‚ºã«å¿œã˜ãŸèª¿æ•´
    if batch_size > 100:
        base_delay = 1.5  # å¤§é‡å‡¦ç†æ™‚ã¯ä¿å®ˆçš„ã«
    elif batch_size < 10:
        base_delay = 0.5  # å°‘é‡å‡¦ç†æ™‚ã¯é«˜é€ŸåŒ–
    
    # å‡¦ç†æ™‚é–“å¸¯ã«ã‚ˆã‚‹èª¿æ•´ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
    current_hour = datetime.now().hour
    if 9 <= current_hour <= 17:  # å–¶æ¥­æ™‚é–“å¸¯
        base_delay *= 1.2  # æ··é›‘æ™‚é–“å¸¯ã¯é…å»¶å¢—åŠ 
    
    return base_delay
```

### **åˆ†æçµæœã®çµ±è¨ˆãƒ»æ´å¯ŸæŠ½å‡º**

#### **ğŸ“Š å‰µä½œæ´å¯Ÿã®è‡ªå‹•æŠ½å‡º**

```python
def extract_creative_insights(self, videos: List[Dict[str, Any]]) -> Dict[str, Any]:
    """åˆ†æçµæœã‹ã‚‰å‰µä½œã«é–¢ã™ã‚‹æ´å¯Ÿã‚’æŠ½å‡º"""
    insights = {
        "creators": {},
        "tools": {"software": set(), "instruments": set(), "equipment": set()},
        "music_trends": {"genres": {}, "moods": {}, "keys": {}},
        "collaboration_patterns": [],
        "lyrics_themes": [],
        "total_analyzed": 0,
        "successful_analyses": 0
    }
    
    print("æ´å¯ŸæŠ½å‡ºã‚’é–‹å§‹ã—ã¾ã™...")
    
    for i, video in enumerate(videos):
        try:
            analysis = video.get('description_analysis')
            if not analysis:
                continue
            
            insights["total_analyzed"] += 1
            
            # ä¿¡é ¼åº¦ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
            confidence = analysis.get('confidence_score', 0)
            if confidence < 0.3:
                print(f"  å‹•ç”» {i+1}: ä¿¡é ¼åº¦ãŒä½ã„ ({confidence:.2f})")
                continue
            
            insights["successful_analyses"] += 1
            
            # ã‚¯ãƒªã‚¨ã‚¤ã‚¿ãƒ¼æƒ…å ±ã‚’é›†è¨ˆ
            creators = analysis.get('creators', {})
            for role, name in creators.items():
                if name and name != "null":
                    if role not in insights["creators"]:
                        insights["creators"][role] = {}
                    if name not in insights["creators"][role]:
                        insights["creators"][role][name] = 0
                    insights["creators"][role][name] += 1
```

**çµ±è¨ˆåˆ†æã®å®Ÿè£…ä¾‹**

```python
# ã‚¯ãƒªã‚¨ã‚¤ã‚¿ãƒ¼æ´»å‹•ãƒ‘ã‚¿ãƒ¼ãƒ³ã®åˆ†æ
def analyze_creator_patterns(self, insights: Dict[str, Any]) -> Dict[str, Any]:
    """ã‚¯ãƒªã‚¨ã‚¤ã‚¿ãƒ¼ã®æ´»å‹•ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’åˆ†æ"""
    
    patterns = {
        "most_active_creators": {},
        "collaboration_frequency": {},
        "role_diversity": {},
        "tool_preferences": {}
    }
    
    # æœ€ã‚‚æ´»ç™ºãªã‚¯ãƒªã‚¨ã‚¤ã‚¿ãƒ¼
    for role, creators in insights["creators"].items():
        sorted_creators = sorted(creators.items(), key=lambda x: x[1], reverse=True)
        patterns["most_active_creators"][role] = sorted_creators[:5]  # ãƒˆãƒƒãƒ—5
    
    # ã‚³ãƒ©ãƒœãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³é »åº¦
    # è¤‡æ•°ã®å½¹å‰²ã‚’æŒã¤ã‚¯ãƒªã‚¨ã‚¤ã‚¿ãƒ¼ã®ç‰¹å®š
    all_creators = set()
    for role_creators in insights["creators"].values():
        all_creators.update(role_creators.keys())
    
    for creator in all_creators:
        roles = []
        for role, role_creators in insights["creators"].items():
            if creator in role_creators:
                roles.append(role)
        
        if len(roles) > 1:
            patterns["collaboration_frequency"][creator] = {
                "roles": roles,
                "count": sum(insights["creators"][role].get(creator, 0) for role in roles)
            }
    
    return patterns
```

### **çµæœä¿å­˜ã¨å“è³ªç®¡ç†**

#### **ğŸ’¾ æ§‹é€ åŒ–ãƒ‡ãƒ¼ã‚¿ä¿å­˜**

```python
def save_analysis_results(self, videos_with_analysis: List[Dict[str, Any]], output_path: str):
    """åˆ†æçµæœã‚’ä¿å­˜"""
    try:
        # åŸºæœ¬çµ±è¨ˆæƒ…å ±
        total_videos = len(videos_with_analysis)
        analyzed_count = sum(1 for v in videos_with_analysis if v.get('description_analysis'))
        
        # å‰µä½œæ´å¯Ÿã‚’æŠ½å‡º
        insights = self.extract_creative_insights(videos_with_analysis)
        
        # ä¿å­˜ãƒ‡ãƒ¼ã‚¿æ§‹é€ 
        save_data = {
            "analysis_info": {
                "total_videos": total_videos,
                "analyzed_videos": analyzed_count,
                "analysis_success_rate": analyzed_count / total_videos if total_videos > 0 else 0,
                "analysis_date": datetime.now().isoformat(),
                "model_used": self.model
            },
            "creative_insights": insights,
            "quality_metrics": {
                "average_confidence": self._calculate_average_confidence(videos_with_analysis),
                "error_rate": (total_videos - analyzed_count) / total_videos,
                "processing_time": "calculated_separately"
            },
            "videos": videos_with_analysis
        }
        
        # JSONä¿å­˜ï¼ˆå¯èª­æ€§é‡è¦–ï¼‰
        with open(output_path, 'w', encoding='utf-8') as f:
            json.dump(save_data, f, ensure_ascii=False, indent=2)
        
        print(f"âœ… åˆ†æçµæœã‚’ä¿å­˜: {output_path}")
        print(f"æˆåŠŸç‡: {analyzed_count}/{total_videos} ({analyzed_count/total_videos*100:.1f}%)")
```

**å“è³ªãƒ¡ãƒˆãƒªã‚¯ã‚¹ã®å®Ÿè£…**

```python
def _calculate_quality_metrics(self, videos_with_analysis: List[Dict[str, Any]]) -> Dict[str, float]:
    """åˆ†æå“è³ªãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚’è¨ˆç®—"""
    
    successful_analyses = [
        v['description_analysis'] for v in videos_with_analysis 
        if v.get('description_analysis') and v['description_analysis'].get('confidence_score', 0) > 0
    ]
    
    if not successful_analyses:
        return {"average_confidence": 0.0, "high_confidence_rate": 0.0}
    
    # å¹³å‡ä¿¡é ¼åº¦
    confidence_scores = [a.get('confidence_score', 0) for a in successful_analyses]
    average_confidence = sum(confidence_scores) / len(confidence_scores)
    
    # é«˜ä¿¡é ¼åº¦ç‡ï¼ˆ0.7ä»¥ä¸Šï¼‰
    high_confidence_count = sum(1 for score in confidence_scores if score >= 0.7)
    high_confidence_rate = high_confidence_count / len(confidence_scores)
    
    # æƒ…å ±æŠ½å‡ºå®Œå…¨æ€§
    complete_extractions = sum(
        1 for a in successful_analyses 
        if a.get('creators') and any(v for v in a['creators'].values() if v and v != "null")
    )
    extraction_completeness = complete_extractions / len(successful_analyses)
    
    return {
        "average_confidence": average_confidence,
        "high_confidence_rate": high_confidence_rate,
        "extraction_completeness": extraction_completeness,
        "total_successful": len(successful_analyses)
    }
```

ã“ã®ç« ã§ã¯ã€OpenAI GPT APIã‚’æ´»ç”¨ã—ãŸé«˜åº¦ãªAIåˆ†æã‚·ã‚¹ãƒ†ãƒ ã®å®Ÿè£…ã‚’è©³ã—ãå­¦ã³ã¾ã—ãŸã€‚ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒªãƒ³ã‚°ã‹ã‚‰å …ç‰¢ãªã‚¨ãƒ©ãƒ¼å‡¦ç†ã¾ã§ã€å®Ÿç”¨çš„ãªAIé€£æºæŠ€è¡“ã‚’ç¿’å¾—ã—ã¾ã—ãŸã€‚æ¬¡ç« ã§ã¯ã€ã“ã®AIåˆ†æçµæœã‚’å«ã‚€å…¨ãƒ‡ãƒ¼ã‚¿ã®çµ±åˆç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã«ã¤ã„ã¦è§£èª¬ã—ã¾ã™ã€‚
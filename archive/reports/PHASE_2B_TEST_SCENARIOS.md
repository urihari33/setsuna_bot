# Phase 2-B 統合機能テストシナリオ

せつなBotの動的学習・記憶強化機能の包括的テストケース集

## 📋 テスト実行手順

### 1. 基本準備
```bash
# せつなBotの起動
python voice_chat_gpt4.py
```

### 2. テスト実行方法
- 各シナリオを順番に実行
- ホットキー（Ctrl+Shift+Alt）を押しながら発話
- せつなの応答内容と学習状況を確認
- 期待される結果と実際の結果を比較

---

## 🧪 テストシナリオ

### シナリオ1: 基本的な記憶・学習機能
**目的**: 会話履歴の記録と嗜好学習の基本動作確認

#### ステップ1-1: 初回動画言及
**入力**: 「アドベンチャーについて教えて」
**期待結果**: 
- 楽曲「アドベンチャー」の情報を提供
- 会話履歴に記録（初回）
- ジャンル・クリエイター情報の学習開始

#### ステップ1-2: ポジティブ反応
**入力**: 「この曲すごくいいね！」
**期待結果**:
- 「この曲」→「アドベンチャー」の文脈参照成功
- ポジティブ反応の学習（嗜好スコア向上）
- 馴染み度スコアの上昇

#### ステップ1-3: 継続会話
**入力**: 「またアドベンチャー聞きたい」
**期待結果**:
- 会話履歴の反映（「前にも話した楽曲」等の言及）
- 親しみやすさレベルの向上
- 継続性ヒントの生成

---

### シナリオ2: 個人化推薦機能
**目的**: 学習された嗜好に基づく推薦機能の確認

#### ステップ2-1: 嗜好パターン蓄積
**入力**: 「ボカロの曲について教えて」
**期待結果**:
- ボカロジャンルの動画情報提供
- ジャンル嗜好の学習

#### ステップ2-2: ポジティブ学習
**入力**: 「ボカロ好き！」
**期待結果**:
- ボカロジャンルへのポジティブ嗜好学習
- 感情分析結果の記録

#### ステップ2-3: 個人化推薦要求
**入力**: 「何かおすすめある？」
**期待結果**:
- 学習されたボカロ嗜好に基づく推薦
- 「あなたの好みに合いそう」等の個人化表現
- 馴染みのある動画と新規発見の混合推薦

#### ステップ2-4: 具体的嗜好推薦
**入力**: 「いつものお気に入りを聞きたい」
**期待結果**:
- 馴染み推薦モードの発動
- 過去にポジティブ反応した動画の優先提示
- 「いつものXXX」等の親しみ表現

---

### シナリオ3: 文脈理解・代名詞解決
**目的**: 自然な会話継続と文脈参照の確認

#### ステップ3-1: 話題確立
**入力**: 「XOXOについて教えて」
**期待結果**:
- XOXO楽曲の情報提供
- アクティブ話題として記録

#### ステップ3-2: 指示語参照
**入力**: 「その動画のクリエイターは誰？」
**期待結果**:
- 「その動画」→「XOXO」の参照解決
- XOXOのクリエイター情報提供
- 文脈参照の明示（「さっきのXOXOについて」等）

#### ステップ3-3: 時間的参照
**入力**: 「さっき聞いた曲もう一度詳しく」
**期待結果**:
- 「さっき聞いた曲」→「XOXO」の時間的参照解決
- より詳細な楽曲情報の提供
- 継続性の認識

#### ステップ3-4: 相対的参照
**入力**: 「似たような曲ある？」
**期待結果**:
- XOXOの特徴（ジャンル・ムード等）に基づく類似曲推薦
- 「XOXOに似た」等の基準明示
- 嗜好学習の活用

---

### シナリオ4: マルチターン対話状態管理
**目的**: 対話状態の自動遷移と品質管理の確認

#### ステップ4-1: 話題確立段階
**入力**: 「ポップスの曲について」
**期待結果**:
- 対話状態: INITIAL → TOPIC_ESTABLISHED
- ポップスジャンルの楽曲情報提供

#### ステップ4-2: 深い議論段階
**入力**: 「もっと詳しく教えて」
**期待結果**:
- 対話状態: TOPIC_ESTABLISHED → DEEP_DISCUSSION
- より詳細な分析・背景情報の提供

#### ステップ4-3: 嗜好学習段階
**入力**: 「すごく好きになった！」
**期待結果**:
- 対話状態: DEEP_DISCUSSION → PREFERENCE_LEARNING
- 強いポジティブ嗜好の学習
- 感情軌跡の記録

#### ステップ4-4: 推薦モード段階
**入力**: 「他にもおすすめして」
**期待結果**:
- 対話状態: PREFERENCE_LEARNING → RECOMMENDATION_MODE
- 学習された嗜好に基づく個人化推薦
- 推薦理由の説明

---

### シナリオ5: 複合機能統合テスト
**目的**: 全機能の連携動作確認

#### ステップ5-1: 初期学習
**入力**: 「TRINITYについて教えて」
**期待結果**:
- TRINITY楽曲情報の提供
- 初回会話として記録

#### ステップ5-2: 感情表現
**入力**: 「この曲泣ける...」
**期待結果**:
- 感情分析（切ない・感動系の検出）
- ムード嗜好の学習
- 感情軌跡への記録

#### ステップ5-3: 別話題への転換
**入力**: 「話は変わって、明るい曲ない？」
**期待結果**:
- 話題転換の認識
- 学習されたムード嗜好（切ない）とは対照的な明るい曲の推薦
- 嗜好多様性の管理

#### ステップ5-4: 文脈を跨いだ参照
**入力**: 「やっぱりさっきの切ない曲の方がいい」
**期待結果**:
- 「さっきの切ない曲」→「TRINITY」の参照解決
- 話題の再活性化
- 嗜好強化の学習

#### ステップ5-5: 統合推薦
**入力**: 「私の好みに合う曲、総合的におすすめして」
**期待結果**:
- 全学習データの統合分析
- 複数ジャンル・ムードを考慮した推薦
- 個人化レベルの高い応答

---

## ✅ 期待される学習データの確認方法

### 学習状況の確認
実装されたシステムは以下のファイルに学習データを保存します：

```
D:/setsuna_bot/data/
├── video_conversation_history.json  # 会話履歴
├── user_preferences.json           # 嗜好学習
├── conversation_context.json       # 文脈理解
└── multi_turn_conversations.json   # マルチターン管理
```

### 成功指標

#### 会話履歴機能
- [ ] 同じ動画への言及回数が累積される
- [ ] 親しみやすさスコアが段階的に向上
- [ ] 会話ヒントが適切に生成される

#### 嗜好学習機能
- [ ] ジャンル別嗜好スコアが蓄積される
- [ ] クリエイター別嗜好が学習される
- [ ] 感情反応が適切に分析される

#### 文脈理解機能
- [ ] 代名詞が正しく検出される
- [ ] 参照解決が適切に実行される
- [ ] アクティブ話題が管理される

#### マルチターン管理
- [ ] 対話状態が適切に遷移する
- [ ] 会話品質が維持される
- [ ] 感情軌跡が記録される

---

## 🚨 トラブルシューティング

### よくある問題と対処法

#### 1. 文脈参照が失敗する
**症状**: 「この曲」「その動画」が解決されない
**確認点**: 
- 直前に動画が言及されているか
- アクティブ話題が正しく記録されているか

#### 2. 個人化推薦が機能しない
**症状**: 学習されたはずの嗜好が反映されない
**確認点**:
- 十分な学習データが蓄積されているか（最低3-5回の相互作用）
- ポジティブ/ネガティブ反応が適切に学習されているか

#### 3. 対話状態が遷移しない
**症状**: 状態がINITIALのまま変わらない
**確認点**:
- 動画言及が正しく検出されているか
- 感情シグナルが適切に分析されているか

#### 4. 学習データが保存されない
**症状**: セッション終了後に学習が失われる
**確認点**:
- データディレクトリ（D:/setsuna_bot/data/）が存在するか
- ファイル書き込み権限があるか

---

## 📊 テスト結果記録テンプレート

```
## テスト実行日時: [日付・時刻]

### シナリオ1: 基本的な記憶・学習機能
- ステップ1-1: ✅/❌ [コメント]
- ステップ1-2: ✅/❌ [コメント]
- ステップ1-3: ✅/❌ [コメント]

### シナリオ2: 個人化推薦機能
- ステップ2-1: ✅/❌ [コメント]
- ステップ2-2: ✅/❌ [コメント]
- ステップ2-3: ✅/❌ [コメント]
- ステップ2-4: ✅/❌ [コメント]

### シナリオ3: 文脈理解・代名詞解決
- ステップ3-1: ✅/❌ [コメント]
- ステップ3-2: ✅/❌ [コメント]
- ステップ3-3: ✅/❌ [コメント]
- ステップ3-4: ✅/❌ [コメント]

### シナリオ4: マルチターン対話状態管理
- ステップ4-1: ✅/❌ [コメント]
- ステップ4-2: ✅/❌ [コメント]
- ステップ4-3: ✅/❌ [コメント]
- ステップ4-4: ✅/❌ [コメント]

### シナリオ5: 複合機能統合テスト
- ステップ5-1: ✅/❌ [コメント]
- ステップ5-2: ✅/❌ [コメント]
- ステップ5-3: ✅/❌ [コメント]
- ステップ5-4: ✅/❌ [コメント]
- ステップ5-5: ✅/❌ [コメント]

### 総合評価
- 成功率: ___/20 (___%)
- 主要な問題: [記述]
- 推奨改善点: [記述]
```

このテストシナリオを実行することで、Phase 2-B の全機能が正常に動作することを確認できます。何か問題が発生した場合は、具体的なエラーメッセージや期待と異なる挙動をお知らせください。
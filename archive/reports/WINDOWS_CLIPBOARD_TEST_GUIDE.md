# 🧪 Windows環境 クリップボード貼り付け機能テストガイド

## 📋 テスト対象機能

Phase 1.5で実装したスクリーンショット・画像貼り付け機能のWindows環境での動作確認

### ✅ 実装済み機能
- **Phase 1.5A**: ファイルパス貼り付け（全環境対応）
- **Phase 1.5B**: スクリーンショット貼り付け（Windows専用）
- **Ctrl+V キーバインド**
- **環境自動検出・フォールバック**
- **一時ファイル自動管理**

## 🎯 テストシナリオ

### **テスト1: スクリーンショット貼り付け**
1. **準備**:
   ```bash
   python voice_chat_gui.py
   ```
   - GUI起動
   - 「🎵 動画学習」タブを選択

2. **スクリーンショット撮影**:
   - `Win + Shift + S` でスクリーンショット撮影
   - または `PrtScr` でフルスクリーンキャプチャ

3. **貼り付けテスト**:
   - 📸 関連画像エリアで `Ctrl+V` を押す
   - または「📋 貼り付け (Ctrl+V)」ボタンをクリック

4. **期待結果**:
   - ✅ 「貼り付け成功」ダイアログ表示
   - ✅ プレビューエリアにスクリーンショット表示
   - ✅ 「選択画像: 1枚」カウンター更新
   - ✅ コンソールに成功ログ出力

### **テスト2: 画像ファイル貼り付け**
1. **準備**:
   - エクスプローラーで画像ファイル（.jpg, .png等）を選択
   - `Ctrl+C` でコピー

2. **貼り付けテスト**:
   - せつなBot GUI の 📸 関連画像エリアで `Ctrl+V`

3. **期待結果**:
   - ✅ 「貼り付け成功」ダイアログ表示
   - ✅ ファイル名表示
   - ✅ プレビュー表示

### **テスト3: 複数画像追加テスト**
1. スクリーンショットを貼り付け
2. 続けて画像ファイルを貼り付け
3. 「📁 画像選択」で追加の画像を選択

4. **期待結果**:
   - ✅ 複数画像が並んで表示される
   - ✅ 正確なカウンター表示
   - ✅ 個別削除ボタン(✕)が機能する

### **テスト4: 動画学習統合テスト**
1. YouTube URL入力: `https://www.youtube.com/watch?v=dQw4w9WgXcQ`
2. スクリーンショット貼り付け
3. 「🧠 学習開始」をクリック

4. **期待結果**:
   - ✅ 学習進捗「関連画像を保存中...」表示
   - ✅ 学習結果に「📸 関連画像: 1枚保存完了」表示
   - ✅ 画像が `/video_images/VIDEO_ID/` に保存される
   - ✅ データベースに画像メタデータ保存

### **テスト5: エラーハンドリングテスト**
1. **空のクリップボードでCtrl+V**:
   - 期待: 「クリップボードに画像が見つかりません」メッセージ

2. **テキストコピー後にCtrl+V**:
   - テキストをコピーして貼り付け
   - 期待: ファイルパスでない場合はエラーメッセージ

3. **非画像ファイルパス貼り付け**:
   - .txtファイルのパスをコピーして貼り付け
   - 期待: 「サポートされていない形式」エラー

## 🔍 詳細確認ポイント

### **ログ出力確認**
コンソール出力で以下を確認：
```
[GUI] ✅ スクリーンショット貼り付け成功: (1920, 1080)
[画像管理] 📁 画像コピー完了: D:/setsuna_bot/video_images/VIDEO_ID/img_xxx.png
[YouTube知識] ✅ 画像追加完了: img_xxx
```

### **ファイルシステム確認**
1. **一時ファイル**:
   - `%TEMP%/setsuna_bot_clipboard/` にPNGファイル作成
   - 学習完了後に30分でクリーンアップ

2. **永続保存**:
   - `D:/setsuna_bot/video_images/VIDEO_ID/` に画像保存
   - `D:/setsuna_bot/video_images/VIDEO_ID/thumbnails/` にサムネイル

### **データベース確認**
`unified_knowledge_db.json` の構造：
```json
{
  "videos": {
    "VIDEO_ID": {
      "images": [
        {
          "image_id": "img_20250704_123456_abc12345",
          "file_path": "D:/setsuna_bot/video_images/VIDEO_ID/img_xxx.png",
          "thumbnail_path": "D:/setsuna_bot/video_images/VIDEO_ID/thumbnails/img_xxx_thumb.jpg",
          "upload_timestamp": "2025-07-04T12:34:56+09:00",
          "user_description": "スクリーンショット貼り付け",
          "file_size": 123456,
          "dimensions": {"width": 1920, "height": 1080},
          "format": "PNG"
        }
      ]
    }
  }
}
```

## 🚨 想定されるエラーと対処法

### **PIL.ImageGrab ImportError**
```python
ImportError: No module named 'PIL.ImageGrab'
```
**対処**: PIL（Pillow）がWindows版でない場合。再インストール推奨。

### **クリップボードアクセスエラー**
```python
Exception: クリップボードにアクセスできません
```
**対処**: 管理者権限での実行、他のアプリケーションの影響確認。

### **ファイル権限エラー**
```python
PermissionError: 'D:/setsuna_bot/video_images/'
```
**対処**: ディレクトリの書き込み権限確認。

## 📊 テスト結果レポート

### **基本動作テスト**
- [ ] スクリーンショット貼り付け成功
- [ ] 画像ファイル貼り付け成功
- [ ] Ctrl+V キーバインド動作
- [ ] 環境情報表示正確

### **統合機能テスト**
- [ ] 動画学習時の画像保存
- [ ] データベース統合
- [ ] UI更新・カウンター

### **エラーハンドリング**
- [ ] 空クリップボード対応
- [ ] 不正ファイル形式対応
- [ ] エラーメッセージ適切

### **パフォーマンス**
- [ ] 大画像（5MB+）処理時間
- [ ] 複数画像同時処理
- [ ] メモリ使用量適正

## 💬 フィードバック項目

テスト完了後、以下について報告してください：

1. **成功した機能**: どの機能が期待通りに動作したか
2. **問題が発生した機能**: エラー内容とその状況
3. **使いやすさ**: UI/UXの改善提案
4. **パフォーマンス**: 応答速度や安定性
5. **追加要望**: あったら便利な機能

## 🎯 追加テストケース（任意）

### **高度なシナリオ**
1. **異なる画像形式**: PNG, JPEG, GIF, BMP での貼り付け
2. **大容量画像**: 10MB+ の高解像度画像
3. **透明背景画像**: RGBA/アルファチャンネル付き画像
4. **連続操作**: 短時間での複数貼り付け
5. **他アプリ連携**: Photoshop、ブラウザからのコピー&ペースト

---

**実装完了！Windowsでのテストをお願いします 🚀**